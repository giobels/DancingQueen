<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DancingQueen - Dashboard</title>
    <link rel="shortcut icon" href="assets/icon.png">
    <link rel="stylesheet" href="css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div id="fundoModal">
    </div>
    <div class="modal" id="modalNovaCoreo">
        <div class="containerModal">
            <img src="assets/botao-x.png" class="botaoFechar" onclick="fecharModalNovaCoreo()">
            <span>Nova Coreografia</span>
            <div class="inputsModal">
                <div class="inputModal">
                    <span>Nome</span>
                    <input type="text" class="inputCoreo" id="input_coreografia" placeholder="Coreografia">
                </div>
                <div class="inputModal">
                    <span>Categoria</span>
                    <select class="inputCoreo" id="input_categoria">
                        <option disabled selected>Selecione uma categoria</option>
                        <option value="flexibilidade">Flexibilidade</option>
                        <option value="forca">Força</option>
                        <option value="tecnica">Técnica</option>
                        <option value="expressao">Expressão</option>
                    </select>
                </div>
            </div>
            <button class="botaoModal" onclick="novaCoreo()">Criar</button>
        </div>
    </div>

    <div class="modal" id="modalFestival">
        <div class="containerModal">
            <img src="assets/botao-x.png" class="botaoFechar" onclick="fecharModalFestival()">
            <span>Cadastrar Festival</span>
            <div class="inputsModal">
                <div class="inputModal">
                    <span>Festival</span>
                    <input type="text" class="inputCoreo" id="input_festival" placeholder="Nome do festival">
                </div>
                <div class="inputModal">
                    <span>Coreografia</span>
                    <select class="inputCoreo" id="select_coreografia">

                    </select>
                </div>
                <div class="inputModal">
                    <span>Data</span>
                    <input type="date" class="inputCoreo" id="input_datafestival">
                </div>

                <div class="inputModal">
                    <span>Nota</span>
                    <input type="number" class="inputCoreo" id="input_notafestival">
                </div>

            </div>
            <button class="botaoModal" onclick="cadastrarFestival()">Criar</button>
        </div>
    </div>

    <header>
        <nav>
            <ul class="navbar">
                <li class="nav-links"> <img src="assets/logout.png">Sair</li>
                <a href="https://suportedancingqueen.hipporello.net/desk?">
                    <li class="nav-links"> <img src="assets/config.png"> Suporte</li>
                </a>
                <li class="nav-links"> <img src="assets/coroa.png">Dashboard</li>
                <li class="nav-links" onclick="opcaoCoreo1()"> <img src="assets/sapatilha.png">Coreografia</li>
            </ul>
            <img src="assets/bailarina.png">
        </nav>
        <div id="opcaoCoreo">
            <ul id="listOpcaoCoreo">
                <li onclick="abrirModalNovaCoreo()">Nova Coreografia</li>
                <li onclick="abrirModalFestival()">Festival</li>
            </ul>
        </div>
    </header>
    <div class="container">
        <div class="lateral">
            <span id="titulo"></span>

            <div class="kpis">
                <div class="kpi">aaaaa</div>
                <div class="kpi">aaaaa</div>
                <div class="kpi">aaaaa</div>
            </div>
            <div class="container-grafico">
                <canvas id="graficoDesempenho" class="grafico"></canvas>
            </div>

        </div>
        <div class="lateral">
            <div class="container-grafico">
                <canvas id="graficoEvolucao" class="grafico"></canvas>
            </div>
            <div class="container-grafico">
                <canvas id="graficoPontuacao" class="grafico"></canvas>
            </div>
        </div>
    </div>
</body>

</html>

<script>
    const labels = [
        'Janeiro',
        'Fevereiro',
        'Março',
        'Abril',
        'Maio',
        'Junho',
    ];

    const data = {
        labels: labels,
        datasets: [{
            label: 'My firt dataset',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: [0, 10, 5, 2, 20, 30, 45],
        },
        {
            label: 'My firt dataset2',
            backgroundColor: 'rgb(132, 99, 255)',
            borderColor: 'rgb(132, 99, 255)',
            data: [10, 20, 15, 12, 30, 40, 55],
        }]
    };

    const config = {
        type: 'bar',
        data: data,
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Custom Chart Title'
                }
            }
        }
    };

    const config2 = {
        type: 'radar',
        data: data,
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Custom Chart Title'
                }
            }
        }
    };

    const config3 = {
        type: 'line',
        data: data,
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Custom Chart Title'
                }
            }
        }
    };

    const graficoDesempenho = new Chart(
        document.getElementById('graficoDesempenho'),
        config)

    const graficoEvolucao = new Chart(
        document.getElementById('graficoEvolucao'),
        config2)

    const graficoPontuacao = new Chart(
        document.getElementById('graficoPontuacao'),
        config3)


</script>

<script>

    titulo.innerHTML = `${sessionStorage.NOME_USUARIO}'s Journey`

    let coreopcao = true;
    function opcaoCoreo1() {

        if (coreopcao) {
            opcaoCoreo.style.height = "100px";
            setTimeout(function () { listOpcaoCoreo.style.display = "flex" }, 150);

            coreopcao = false;
        } else {
            opcaoCoreo.style.height = "0px";
            listOpcaoCoreo.style.display = 'none';
            coreopcao = true;
        }

    }

    function novaCoreo() {
        const coreografia = input_coreografia.value.trim();
        const categoria = input_categoria.value.trim();
        const fkUsuario = sessionStorage.ID_USUARIO;

        if (coreografia == '' || categoria == '') {
            alert('Insira uma coreografia a categoria válida.')
        } else {
            fetch("/coreo/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({

                    coreografiaServer: coreografia,
                    categoriaServer: categoria,
                    usuarioServer: fkUsuario,
                }),
            })
            alert('Nova coreografia adicionada!')
        }
    }

    function cadastrarFestival() {
        const festival = input_festival.value.trim();
        const data = input_datafestival.value;
        const nota = input_notafestival.value.trim();
        const coreo = select_coreografia.value;

        if (festival == '' || data == '' || nota == '' || !coreo) {
            alert('Preencha todos os campos para continuar!')
        } else {
            fetch("/festival/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({

                    festivalServer: festival,
                    dataServer: data,
                    notaServer: nota,
                    coreoServer: coreo,

                }),
            })

            alert('Novo Festival adicionado!')

        }

    }

    function listar() {
        const fkUsuario = sessionStorage.ID_USUARIO;

        fetch("/coreo/listar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                fkusuarioServer: fkUsuario,
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then((coreo) => {
                    coreo.forEach((coreografia) => {
                        select_coreografia.innerHTML += `<option value='${coreografia.idCoreografia}'>${coreografia.coreografia}</option>`;
                    });
                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }


    // fetch("/coreo/listar", {
    //     method: "GET",
    // })
    //     .then(function (resposta) {
    //         resposta.json().then((coreo) => {
    //             coreo.forEach((coreografia) => {
    //                 select_coreografia.innerHTML += `<option value='${coreografia.idCoreografia}'>${coreografia.coreografia}</option>`;
    //             });
    //         });
    //     })
    //     .catch(function (resposta) {
    //         console.log(`#ERRO: ${resposta}`);
    //     });


    function abrirModalNovaCoreo() {
        fundoModal.style.display = "block";
        modalNovaCoreo.style.display = "flex";
        opcaoCoreo.style.height = "0px";
        listOpcaoCoreo.style.display = 'none';
        coreopcao = true;
    }

    function fecharModalNovaCoreo() {
        fundoModal.style.display = "none";
        modalNovaCoreo.style.display = "none";
    }

    function abrirModalFestival() {
        select_coreografia.innerHTML = '<option disabled selected>Selecione uma coreografia</option>';
        fundoModal.style.display = "block";
        modalFestival.style.display = "flex";
        opcaoCoreo.style.height = "0px";
        listOpcaoCoreo.style.display = 'none';
        coreopcao = true;
        listar();
    }

    function fecharModalFestival() {
        fundoModal.style.display = "none";
        modalFestival.style.display = "none";
    }
</script>